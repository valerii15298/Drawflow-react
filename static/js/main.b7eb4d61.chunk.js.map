{"version":3,"sources":["types.ts","components/drawflowHandler.ts","styles.ts","redux/Node.ts","redux/Flow.ts","redux/drawflowSlice.ts","redux/hooks.ts","components/Connection/index.ts","components/Connection/Circle.tsx","components/Connection/Path.tsx","components/NodeComponents.tsx","components/DrawflowNodeBlock.tsx","Mock/fields.mock.ts","Mock/index.ts","redux/store.ts","components/ButtonArea/DrawflowAdditionalArea.tsx","components/ButtonArea/DrawflowZoomArea.tsx","components/DrawflowHook.tsx","components/FilterList.tsx","App.tsx","index.tsx"],"names":["NODE_TYPE","Slices","getCanvasInfo","canvas","document","querySelector","canvasRect","getBoundingClientRect","x","y","width","clientWidth","height","clientHeight","handler","createCurvature","start","end","halfHeiht","dx","getPos","clientX","clientY","zoom","findIndexByElement","elmt","parentElement","arr","Array","from","childNodes","i","length","getPortPosWithZoom","size","pos","coef","MODAL_TYPE","portType","subnodeStyle","Node","id","flow","state","nodeState","spacingX","spacingY","this","drawflow","head","lane","port","Object","entries","ports","find","key","filter","startsWith","parentId","keys","connections","split","toString","getNode","Number","map","parent","Math","max","subnodesWidth","leftWidth","rightWidth","out1","totalWidth","forEach","node","update","isSub","out","xPos","console","log","setPos","alignChildren","subnodes","subNode","side","childrenTotalWidth","sideChildrenWidth","leftChildWidth","rightChildWidth","selfLeftWidth","childrenRightWidth","selfRightWidth","portId","conn","children","firstSubnode","flowLine","flowLineNodes","reduce","acc","hasSubnodes","push","newPos","moveNode","nodeId","dy","data","newData","lodash","merge","assign","Flow","nodes","distanceToConnect","distanceToDisconnect","el","setLaneNumbers","heads","startId","startPort","endId","endPort","connectionAllowed","currentNode","currentNodeHead","parentConnection","alignAll","nodeInPortPos","portInPos","portDistances","outPorts","distance","hypot","sort","a","b","nearestPort","portToConnect","undefined","laneNodes","nextLaneNodes","nextNodes","nextNode","error","initialState","canvasDrag","config","drag","connectionsLabelEnable","canvasTranslate","value","min","tick","connectionsLabel","select","selectId","selectPath","showButton","newPathDirection","modalType","editLock","mouseBlockDragPos","addNode","payload","type","slice","createSlice","name","Drawflow","reducers","setEditLock","align","action","dragNode","setMouseBlockDragPos","unSelect","moveCanvas","movementX","movementY","canvasMouseMove","prevX","prevY","canvasMouseUp","v","addConnection","deleteNode","_","val","parseInt","deletePath","load","clear","pushPorts","newValue","nodeSize","actions","drawflowSlice","reducer","selectActiveDrawflow","flows","version","useAppDispatch","useDispatch","useAppSelector","useSelector","Connection","Circle","props","property","svgKey","xmlns","className","r","onMouseDown","e","Path","d","dispatch","stopPropagation","Round","JSON","stringify","DrawflowNodeBlock","ref","useRef","portComponent","portKey","onMouseUp","useEffect","current","offsetHeight","offsetWidth","getPortPos","getComputedStyle","left","top","inputs","outputs","newPorts","in","style","cursor","onContextMenu","onDoubleClick","makeRandomNames","searchWord","result","j","word","floor","random","charAt","getGroups","number","rnd","rez","testNode","MIDDLE","mock","getDummy","getFilters","changeVersion","createAction","addNewNode","dragTemplate","drawflowInitialState","templates","fetchNodeTemplates","createAsyncThunk","fetchFlowVersion","createReducer","builder","addCase","appState","fulfilled","addMatcher","store","configureStore","DrawflowAdditionalArea","s","onClick","DrawflowZoomArea","NewPath","startKey","ConnectionList","conns","endKey","selectDrawflow","createDraftSafeSelector","NodeList","values","handleKeyDown","addEventListener","removeEventListener","currentTarget","classList","contains","onMouseMove","onMouseEnter","transform","FilterList","list","searchArr","toLowerCase","item","idx","label","includes","onMouseDownCapture","App","useState","setSearchWord","placeholder","onChange","target","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b7eb4d61.chunk.js","sourcesContent":["export enum NODE_TYPE {\n    START = 'START',\n    MIDDLE = 'MIDDLE',\n    END = 'END',\n}\n\nexport enum Slices {\n    Drawflow = 'drawflow'\n}\n\nexport const CURV = 0.3;\n\nexport enum MODAL_TYPE {\n    NODE_SETTINGS = \"NODE_SETTINGS\",\n    GROUP_SETTINGS = \"GROUP_SETTINGS\",\n}\n\nexport enum portType {\n    in='in',\n    out='out'\n}\n\nexport type pos = {\n    x: number,\n    y: number,\n}\n\nexport type clientPos = {\n    clientX: number,\n    clientY: number,\n}\n\nexport type port = {\n    in: number,\n    out: number,\n}\n\n\n\nexport type ports = {\n    [propName: string]: pos\n}\n\n\n\nexport type block = {\n    name: string,\n    type: string,\n    value: string,\n    create?: boolean\n}\n\n\n\nexport type dataNode = {\n    type: string\n    data: block\n    port: port\n    pos: pos\n    isSub: boolean\n}\n\nexport interface node extends dataNode {\n    id: number\n    height: number\n    width: number\n    lane?: number\n    position?: number\n    head?: number\n}\n\ntype RecursivePartial<T> = {\n    [P in keyof T]?:\n    T[P] extends (infer U)[] ? RecursivePartial<U>[] :\n    T[P] extends object ? RecursivePartial<T[P]> :\n    T[P];\n}\n\nexport type updateNode = RecursivePartial<node>\n\nexport type drawflow = {\n    [id: number]: node\n}\n\nexport type connections = {\n    [propName: string]: pos[]\n}\n\nexport type data = {\n    nodes: drawflow,\n    connections: connections,\n    connectionsLabel?: {\n        [propName: string]: string\n    },\n}\n\nexport interface stateData {\n    nodeId: number,\n    canvasDrag: boolean,\n    config: {\n        drag: boolean,\n        connectionsLabelEnable: boolean,\n        canvasTranslate: pos,\n        zoom: {\n            value: number,\n            max: number,\n            min: number,\n            tick: number,\n        },\n    },\n    drawflow: drawflow,\n    modalType: string | null,\n    newPathDirection: clientPos | null,\n    ports: ports,\n    connections: connections,\n    connectionsLabel: {\n        [propName: string]: string\n    },\n    selectId: string | number | null,\n    select: { type: string, portId?: number, selectId?: string | number } | null,\n    selectPath: string | null,\n    showButton: number | null,\n    editLock: boolean,\n    mouseBlockDragPos: { clientX?: number, clientY?: number },\n    portToConnect?: string\n}\n\nexport interface flowType {\n    version: number\n    flows: stateData[]\n    dragTemplate?: number\n    templates: block[]\n}\n\nexport type addConnectionType = { startId: number, startPort: number, endId: number, endPort: number }\nexport type loadType = { drawflow: drawflow, connections: connections }\nexport type moveNodeType = { dx: number, dy: number, nodeId: number }","import { CURV, stateData } from \"../types\";\n\nimport { pos } from \"../types\";\n\nexport const getPortListByNodeId = (nodeId: number, state: stateData) => {\n  const { ports } = state;\n  return Object.keys(ports).filter(key => key.split(/_/g)[0] === \"\" + nodeId);\n}\n\nconst createCurvature = (start: pos, end: pos) => {\n  const halfHeiht = (start.y - end.y) / 2\n  const dx = start.x - end.x\n  return `M ${start.x} ${start.y} v ${-halfHeiht} h ${-dx} v ${-halfHeiht} `\n}\n\nconst getCanvasInfo = () => {\n  // TODO : replace querySelector to someting\n  const canvas = (document.querySelector(\"#drawflow\") as HTMLElement).querySelector(\".drawflow\") as HTMLElement;\n  const canvasRect = canvas.getBoundingClientRect();\n  return {\n    x: canvasRect.x,\n    y: canvasRect.y,\n    width: canvas.clientWidth,\n    height: canvas.clientHeight,\n  };\n}\n\nconst getPos = (clientX: number, clientY: number, zoom: number) => {\n  const { x, y, width, height } = getCanvasInfo();\n  return {\n    x: clientX * (width / (width * zoom)) - (x * (width / (width * zoom))),\n    y: clientY * (height / (height * zoom)) - (y * (height / (height * zoom))),\n  }\n}\n\nconst findIndexByElement = (elmt: HTMLElement) => {\n  const parentElement = elmt.parentElement as HTMLElement;\n  const arr = Array.from(parentElement.childNodes);\n\n  for (let i = 0; i < arr.length; i++) {\n    if (arr[i] === elmt) return i;\n  }\n  return -1;\n}\n\nconst getPortPosWithZoom = (size: { width: number, height: number }, pos: pos, zoom: number) => {\n  const canvas = handler.getCanvasInfo();\n  const coef = 1 / zoom\n\n  const x = size.width / 2 + (pos.x - canvas.x) * coef;\n  const y = size.height / 2 + (pos.y - canvas.y) * coef;\n\n  return { x, y };\n}\n\nconst handler = {\n  createCurvature,\n  getCanvasInfo,\n  getPos,\n  findIndexByElement,\n  getPortPosWithZoom,\n}\n\nexport default handler\n","export const subnodeStyle = {\n    width: 100,\n    height: 60,\n}\n\n","import lodash from \"lodash\"\nimport { subnodeStyle } from \"../styles\"\nimport { node, port, pos, stateData, updateNode } from \"../types\"\nimport { Flow } from \"./Flow\"\n\nexport default class Node {\n    public readonly id: number\n    private readonly state: stateData\n    public readonly flow: Flow\n    public readonly nodeState: node\n    public readonly spacingX = 40\n    public readonly spacingY = 60\n\n    constructor(id: number, flow: Flow) {\n        this.id = id\n        this.flow = flow\n        this.state = flow.state\n        this.nodeState = this.state.drawflow[this.id]\n    }\n\n    get head() {\n        return this.nodeState.head\n    }\n\n    get lane() {\n        return this.nodeState.lane\n    }\n\n    get port(): port {\n        return this.nodeState.port\n    }\n\n    get portInPos(): pos | undefined {\n        return Object.entries(this.state.ports).find(([key, value]) => key === `${this.id}_in_1`)?.[1]\n    }\n\n    get outPorts() {\n        return Object.entries(this.state.ports).filter(([key, pos]) => key.startsWith(`${this.id}_out`))\n    }\n\n    get parent(): Node | null {\n        const parentId = Object.keys(this.state.connections).find(key => key.split('_')[2] === this.id.toString())?.split('_')[0]\n        return parentId ? this.flow.getNode(Number(parentId)) : null\n    }\n\n    get parentConnection() {\n        return Object.keys(this.state.connections).find((key) => {\n            const arr = key.split('_').map(Number)\n            return arr[0] === this.parent?.id && arr[2] === this.id && arr[3] === 1\n        })\n    }\n\n    get totalWidth() {\n        const totalWidth = Math.max(this.width + this.subnodesWidth, this.leftWidth + this.rightWidth)\n        return totalWidth\n    }\n\n    get childrenTotalWidth() {\n        const { out1 } = this\n        if (!out1.length) return 0\n\n        let totalWidth = 0\n        out1.forEach(node => {\n            totalWidth += node.totalWidth\n        })\n        return totalWidth + this.spacingX * (out1.length - 1)\n    }\n\n    alignChildren() {\n        const { out1 } = this\n        this.update({ isSub: false, port: { out: 2 } })\n\n\n        let xPos = this.pos.x - (this.leftWidth - this.width / 2)\n\n        if (this.id === 4) console.log(this.leftWidth, this.width)\n        for (const node of out1) {\n            const x = xPos + (node.leftWidth - node.width / 2)\n            node.setPos({ x, y: this.pos.y + this.height + this.spacingY })\n            xPos += node.totalWidth + this.spacingX\n            node.alignChildren()\n        }\n\n        const { subnodes } = this\n        if (subnodes.length) {\n\n            xPos = this.pos.x + this.width + this.spacingX\n            subnodes.forEach(subNode => {\n                subNode.update({ isSub: true, port: { out: 1 }, ...subnodeStyle })\n                subNode.setPos({ x: xPos, y: this.pos.y + (this.height / 2 - subNode.height / 2) })\n                delete this.state.ports[`${subNode.id}_out_2`]\n                xPos += subNode.width + this.spacingX\n            })\n        }\n    }\n\n    sideChildrenWidth(side: \"left\" | \"right\"): number {\n        const { out1, childrenTotalWidth } = this\n        if (!out1.length) {\n            if (side === \"right\") return this.width / 2 + this.subnodesWidth\n            return this.width / 2\n        }\n\n        if (out1.length === 1) {\n            return out1[0].sideChildrenWidth(side);\n        }\n\n        const leftChildWidth = out1[0].leftWidth\n        const rightChildWidth = out1[out1.length - 1].rightWidth\n        if (this.id === 4) console.log({ leftChildWidth, rightChildWidth })\n\n        return Number(side === \"left\") * leftChildWidth +\n            Number(side === \"right\") * rightChildWidth\n            + (childrenTotalWidth - leftChildWidth - rightChildWidth) / 2\n    }\n\n    get leftWidth(): number {\n        const { out1, childrenTotalWidth } = this\n        const selfLeftWidth = this.width / 2\n        if (!out1.length) {\n            return selfLeftWidth\n        }\n\n        const leftChildWidth = out1[0].leftWidth\n        const rightChildWidth = out1[out1.length - 1].rightWidth\n\n        let childrenRightWidth = leftChildWidth + (childrenTotalWidth - leftChildWidth - rightChildWidth) / 2\n        return Math.max(childrenRightWidth, selfLeftWidth)\n    }\n\n    get rightWidth(): number {\n        const { out1, childrenTotalWidth } = this\n        const selfRightWidth = this.width / 2 + this.subnodesWidth\n        if (!out1.length) {\n            return selfRightWidth\n        }\n\n        const leftChildWidth = out1[0].leftWidth\n        const rightChildWidth = out1[out1.length - 1].rightWidth\n\n        let childrenRightWidth = rightChildWidth + (childrenTotalWidth - leftChildWidth - rightChildWidth) / 2\n        return Math.max(childrenRightWidth, selfRightWidth)\n    }\n\n    children(portId: number) {\n        return Object.keys(this.state.connections)\n            .filter(key => key.split('_')[0] === this.id.toString() && key.split('_')[1] === portId.toString())\n            .map(conn => this.flow.getNode(Number((conn.split('_')[2]))))\n    }\n\n    get out1() {\n        return this.children(1)\n    }\n\n    get firstSubnode(): Node | undefined {\n        return this.children(2)[0]\n    }\n\n    get subnodes(): Node[] {\n        return this.firstSubnode?.flowLine?.flowLineNodes || []\n    }\n\n    get subnodesWidth(): number {\n        return this.subnodes.reduce((acc, subNode) => {\n            return acc + subNode.width + this.spacingX\n        }, 0)\n    }\n\n    get isSub(): boolean {\n        let parent = this.parent\n        if (parent) {\n            if (parent.firstSubnode === this) return true\n            return parent.isSub\n        }\n        return false\n    }\n\n    get complexParentNode() {\n        // if is sub eturn complexNode to which belongs this subnode\n        return null\n    }\n\n    /**\n     * If not flow line, - returns null\n     */\n    get flowLine(): null | { flowLineNodes: Node[], hasSubnodes: Node | undefined } {\n        const flowLineNodes: Node[] = [this];\n        let node: Node = this;\n        let hasSubnodes = node.firstSubnode;\n\n        while (node.out1.length === 1) {\n            hasSubnodes = hasSubnodes || node.firstSubnode;\n            node = node.out1[0]\n            flowLineNodes.push(node);\n        }\n\n        return (node.out1.length > 1) ? null : { flowLineNodes, hasSubnodes };\n    }\n\n    get height() {\n        return this.state.drawflow[this.id].height\n    }\n    get width() {\n        return this.state.drawflow[this.id].width\n    }\n\n    get data() {\n        return {}\n    }\n\n    get pos() {\n        return this.state.drawflow[this.id].pos\n    }\n\n    setPos(newPos: pos) {\n        const { pos } = this;\n        const { x, y } = newPos;\n        this.flow.moveNode({ nodeId: this.id, dx: x - pos.x, dy: y - pos.y })\n    }\n\n    update(data: updateNode) {\n        const newData = lodash.merge(this.nodeState, data)\n        Object.assign(this.nodeState, newData)\n    }\n}","import { addConnectionType, moveNodeType, stateData } from \"../types\";\nimport Node from './Node'\n\n\nexport class Flow {\n    // readonly because we are using only immer.js with redux-toolkit\n    public readonly state: stateData\n    public readonly nodes: { [id: number]: Node } = {}\n    public readonly distanceToConnect = 100\n    public readonly distanceToDisconnect = 0\n\n    constructor(state: stateData) {\n        this.state = state\n        const { drawflow } = this.state\n        Object.keys(drawflow).map((id) => this.nodes[Number(id)] = new Node(Number(id), this))\n    }\n\n    get heads() {\n        return Object.entries(this.nodes).filter(([id, node]) => !node.parent).map(el => el[1])\n    }\n\n    getNode(id: number) {\n        return this.nodes[id]\n    }\n\n    alignAll() {\n        this.setLaneNumbers()\n        this.heads.forEach(node => {\n            // node.calculateFullWidth()\n            node.alignChildren()\n        })\n    }\n\n    addConnection(conn: addConnectionType) {\n        const { startId, startPort, endId, endPort } = conn\n        if (!this.connectionAllowed(conn)) return\n        const key = `${startId}_${startPort}_${endId}_${endPort}`;\n        this.state.connections[key] = []\n    }\n\n    connectionAllowed({ startId, startPort, endId, endPort }: addConnectionType): boolean {\n        if ((startPort === 2 && this.getNode(startId).children(startPort).length)\n            || this.getNode(endId).parent)\n            return false\n        const nodeIn = this.getNode(endId)\n        // const nodeOut = this.getNode(startId)\n\n        const flowLine = nodeIn.flowLine\n\n        const connectAsSub = startPort === 2\n\n        if (connectAsSub) {\n            if (!flowLine || flowLine.hasSubnodes) { return false }\n        }\n        if (this.getNode(startId).out1.length && this.getNode(startId).isSub) {\n            return false\n        }\n\n        return true\n    }\n\n    moveNode({ dx, dy, nodeId }: moveNodeType) {\n        this.state.drawflow[nodeId].pos.x += dx\n        this.state.drawflow[nodeId].pos.y += dy\n    }\n\n    dragNode({ dx, dy, nodeId }: moveNodeType) {\n        this.moveNode({ dx, dy, nodeId })\n\n        /**\n         * Attachment\n         * \n         * traverse all other nodes except this one,\n         * check if their ports are free for new conn, check distance\n         */\n\n        const currentNode = this.getNode(nodeId)\n        const currentNodeHead = currentNode.head\n        if (currentNode.parentConnection) {\n            // remove connection\n            delete this.state.connections[currentNode.parentConnection]\n            this.alignAll()\n        }\n        const nodeInPortPos = currentNode.portInPos\n        if (!nodeInPortPos) return\n        const portDistances: Array<{ key: string, distance: number }> = []\n        Object.entries(this.nodes)\n            .filter(([_, node]) => node.head !== currentNodeHead)\n            .forEach(([id, node]) => {\n                if (Number(id) === nodeId) return\n                node.outPorts.forEach(([key, pos]) => {\n                    const distance = Math.hypot(nodeInPortPos.x - pos.x, nodeInPortPos.y - pos.y)\n                    portDistances.push({ key, distance })\n                })\n            });\n        portDistances.sort((a, b) => (a.distance - b.distance))\n\n        if (portDistances.length) {\n            const nearestPort = portDistances[0]\n            if (nearestPort.distance < this.distanceToConnect) {\n                this.state.portToConnect = nearestPort.key\n            } else {\n                this.state.portToConnect = undefined\n            }\n        }\n    }\n\n    setLaneNumbers() {\n        let laneNodes = this.heads\n        laneNodes.forEach(node => node.update({ head: node.id, lane: 0 }))\n\n        while (laneNodes.length) {\n            const nextLaneNodes: Array<Node> = [];\n            laneNodes.forEach(node => {\n                let lane = node.lane as number + 1\n                const { subnodes, head } = node\n                if (head === undefined) { console.error('head is undefined in setLaneNumbers'); return }\n                if (subnodes.length) {\n                    // console.log({ subnodes })\n                    for (const sub of subnodes) {\n                        sub.update({ lane: lane++, head })\n                    }\n                }\n                const nextNodes = node.children(1)\n                nextNodes.forEach(nextNode => nextNode.update({ head, lane }))\n                nextLaneNodes.push(...nextNodes)\n            })\n            laneNodes = nextLaneNodes;\n        }\n    }\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit'\nimport { dataNode, ports, Slices, stateData, clientPos, addConnectionType, loadType, moveNodeType } from '../types'\nimport { Flow } from './Flow'\nimport type { RootState } from './store'\n\nexport const initialState: stateData = {\n  nodeId: 1,\n  canvasDrag: false,\n  config: {\n    drag: false,\n    connectionsLabelEnable: false,\n    canvasTranslate: {\n      x: 0,\n      y: 0,\n    },\n    zoom: {\n      value: 1,\n      max: 2,\n      min: 0.5,\n      tick: 0.1,\n    },\n  },\n  drawflow: {},\n  connections: {},\n  connectionsLabel: {},\n  ports: {},\n  select: null,\n  selectId: null,\n  selectPath: null,\n  showButton: null,\n  newPathDirection: null,\n  modalType: null,\n  editLock: false,\n  mouseBlockDragPos: { clientX: undefined, clientY: undefined },\n}\n\nexport const addNode = (state: stateData, payload: dataNode) => {\n  state.drawflow[state.nodeId] = { ...payload, id: state.nodeId, height: 0, width: 0 }\n  state.selectId = state.nodeId++\n  state.select = { type: 'node', selectId: state.selectId }\n  state.config.drag = true\n}\n\n// load version from server\n\nconst load = (state: stateData, { payload }: PayloadAction<loadType>) => {\n  Object.assign(state, initialState)\n  state.drawflow = payload.drawflow\n  state.nodeId = Object.keys(payload.drawflow).length + 1\n  state.connections = payload.connections\n  return state\n}\n\nconst align = (state: stateData) => {\n  const flow = new Flow(state)\n  // const { isSub, id } = flow.getNode(1)\n  // console.log(flow.getNode(1).calculateFullWidth())\n  // flow.setLaneNumbers()\n  flow.alignAll()\n}\n\n\nconst slice = createSlice({\n  name: Slices.Drawflow,\n  initialState,\n  reducers: {\n    setEditLock: (state, { payload }: PayloadAction<boolean>) => {\n      state.editLock = payload\n    },\n    align,\n    addNode: (state: stateData, { payload }: PayloadAction<dataNode>) => addNode(state, payload),\n    moveNode: (state, action: PayloadAction<moveNodeType>) => (new Flow(state)).dragNode(action.payload),\n    setMouseBlockDragPos: (state: stateData, { payload }: PayloadAction<clientPos>) => {\n      state.mouseBlockDragPos = payload\n    },\n    unSelect: (state) => {\n      state.config.drag = false\n      state.select = null\n      state.selectId = null\n      state.showButton = null\n    },\n    select: (state, { payload }: PayloadAction<{ type: 'node' | 'path' | 'input' | 'output', portId?: number, selectId?: string | number }>) => {\n      const { type, selectId } = payload;\n      state.config.drag = type === 'node'\n      state.select = payload\n      state.selectId = selectId ?? null;\n    },\n    moveCanvas: (state, { payload: { movementX, movementY } }: PayloadAction<{ movementX: number, movementY: number }>) => {\n      if (state.canvasDrag) {\n        state.config.canvasTranslate.x += movementX\n        state.config.canvasTranslate.y += movementY\n      }\n    },\n    canvasDrag: (state, { payload }: PayloadAction<boolean>) => {\n      state.canvasDrag = payload\n    },\n    canvasMouseMove: (state, { payload: { movementX, movementY, clientX, clientY } }: PayloadAction<{ clientX: number, clientY: number, movementX: number, movementY: number }>) => {\n      if (state.canvasDrag) {\n        state.config.canvasTranslate.x += movementX\n        state.config.canvasTranslate.y += movementY\n        // console.log('Drag canvas')\n      } else if (state.select?.type === 'output') {\n        state.newPathDirection = { clientX, clientY }\n        // console.log('New path')\n      } else if (state.config.drag && typeof state.selectId === 'number') {\n        // move node\n        // console.log('Move node')\n        const nodeId = state.selectId\n        const { clientX: prevX, clientY: prevY } = state.mouseBlockDragPos as clientPos\n        state.mouseBlockDragPos = { clientX, clientY }\n        const coef = (state.config.zoom.value)\n        const dx = (clientX - prevX) / coef\n        const dy = (clientY - prevY) / coef;\n        (new Flow(state)).dragNode({ nodeId, dy, dx })\n      }\n    },\n    canvasMouseUp: (state) => {\n      const flow = new Flow(state)\n      if (state.portToConnect) {\n        const [startId, , startPort] = state.portToConnect.split('_').map(v => Number(v))\n        // console.log([startId, startPort])\n        const endId = Number(state.selectId)\n        const endPort = 1\n        flow.addConnection({ startId, startPort, endId, endPort })\n      }\n      state.portToConnect = undefined\n      state.newPathDirection = null\n      state.canvasDrag = false\n      state.config.drag = false\n      if (state.select?.type === 'output') {\n        state.select = null\n      }\n      flow.alignAll()\n    },\n    deleteNode: (state) => {\n      const { connections, drawflow, ports, selectId } = state;\n      if (!selectId || (typeof selectId !== 'number')) return;\n\n      // 1. find in connections\n      Object.keys(connections).reduce((_, val) => {\n        const arr = val.split(\"_\").map(v => parseInt(v));\n        if (arr[0] * 1 === selectId || arr[2] * 1 === selectId) {\n          delete connections[val];\n        }\n        return null;\n      }, null);\n      // 2. find in ports\n      Object.keys(ports).reduce((_, val) => {\n        const arr = val.split(\"_\").map(v => parseInt(v));\n        if (arr[0] * 1 === selectId) {\n          delete ports[val];\n        }\n        return null;\n      }, null);\n      // 3. find in drawflow\n      delete drawflow[selectId];\n\n      state.select = null\n      state.selectId = null\n      state.showButton = null\n    },\n    deletePath: (state) => {\n      const { selectId, connections } = state\n      if (typeof selectId === 'string')\n        delete connections[selectId];\n    },\n    load,\n    addConnection: (state, action: PayloadAction<addConnectionType>) => {\n      const flow = new Flow(state)\n      flow.addConnection(action.payload)\n    },\n    clear: () => initialState,\n    pushPorts: (state: stateData, { payload }: PayloadAction<ports>) => {\n      state.ports = { ...state.ports, ...payload }\n    },\n    zoom: (state, { payload }: PayloadAction<boolean | null>) => {\n      const { zoom } = state.config;\n      const { value, max, min, tick } = zoom\n      const newValue = value + (payload ? tick : -tick)\n      if (newValue <= max && newValue >= min) {\n        zoom.value = newValue\n      }\n      if (payload === null) {\n        state.config.canvasTranslate = { x: 0, y: 0 }\n        zoom.value = 1\n      }\n    },\n    nodeSize: (state, { payload: { height, width, id } }: PayloadAction<{ id: number, height: number, width: number }>) => {\n      state.drawflow[id].height = height\n      state.drawflow[id].width = width\n      // align(state)\n    }\n  },\n})\n\nexport const actions = slice.actions\nexport const drawflowSlice = slice.reducer\n\n// Other code such as selectors can use the imported `RootState` type\nexport const selectActiveDrawflow = (state: RootState) => state.flows[state.version]\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\nimport type { RootState, AppDispatch } from './store'\n\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector","import Circle from \"./Circle\"\nimport Path from \"./Path\"\n\nconst Connection = {\n    Circle,\n    Path\n}\n\nexport default Connection\n","import { MouseEvent } from \"react\";\n\nconst CircleComponent = (props: any) => {\n    const { property, svgKey, i, editLock } = props;\n\n    const onMouseDown = (e: MouseEvent) => {\n        if (editLock) return;\n        props.select(e, {\n            svgKey,\n            i,\n        });\n    }\n\n    return (\n        <circle\n            {...property}\n            xmlns=\"http://www.w3.org/2000/svg\"\n            className=\"point\"\n            r={6}\n            onMouseDown={onMouseDown}\n        />\n    );\n}\n\nexport default CircleComponent;\n","import { actions, selectActiveDrawflow } from '../../redux/drawflowSlice'\nimport { useAppSelector, useAppDispatch } from '../../redux/hooks'\n\ntype Props = {\n    svgKey?: string,\n    d: string,\n}\n\nconst Path = (props: Props) => {\n    const { svgKey, d } = props;\n    const state = useAppSelector(selectActiveDrawflow)\n    const { selectId } = state;\n    const dispatch = useAppDispatch()\n\n\n    const className = \"main-path \" + ((selectId === svgKey && svgKey) ? 'select' : '')\n\n    return <path\n        xmlns=\"http://www.w3.org/2000/svg\"\n        className={className}\n        d={d}\n        onMouseDown={(e) => {\n            e.stopPropagation()\n            // if (editLock) return;\n            dispatch(actions.select({ type: 'path', selectId: svgKey }))\n        }}\n    ></path>\n\n}\n\nexport default Path;\n","// import { useState } from \"react\";\n// import { Grabme, More } from \"../svg\"\n\nexport const Round = (props: any) => {\n    // const [a] = useState(props)\n    return (\n        <div className=\"node-block\" >\n            {JSON.stringify(props, null, 2)}\n        </div>\n    )\n\n    // const { imgSrc, name, description } = props;\n    // return (\n    //     <div className=\"blockelem create-flowy\">\n    //         <div className=\"grabme\">\n    //             <Grabme />\n    //         </div>\n    //         <div className=\"blockin\">\n    //             <div className=\"blockico\">\n    //                 <span></span>\n    //                 <img src={imgSrc} alt={name + '\\n' + description} />\n    //             </div>\n    //             <div className=\"blocktext\">\n    //                 <p className=\"blocktitle\">{name}</p>\n    //                 <div className=\"side-elem-more\">\n    //                     <More />\n    //                 </div>\n    //                 <p className=\"blockdesc\">{description}</p>\n    //             </div>\n    //         </div>\n    //     </div>)\n}","import { useEffect, useRef, } from \"react\";\nimport { portType } from \"../types\";\n\nimport { actions, selectActiveDrawflow } from '../redux/drawflowSlice'\nimport { useAppSelector, useAppDispatch } from '../redux/hooks'\nimport { Round } from \"./NodeComponents\";\nimport { subnodeStyle } from \"../styles\";\n\n\nconst DrawflowNodeBlock = ({ id }: { id: number }) => {\n    // console.log(`Render node id: ${id}`)\n    const { portToConnect, nodeId, selectId, select, config: { drag }, drawflow: { [id]: node } } =\n        useAppSelector(selectActiveDrawflow)\n    const dispatch = useAppDispatch()\n    const { port, pos } = node;\n\n    const ref = useRef<HTMLDivElement>(null);\n\n    const portComponent = (type: portType) => {\n        let arr = [];\n\n        for (let i = 1; i <= port[type]; i++) {\n            const key = `${type}put-${i}`;\n            const portKey = `${id}_${type}_${i}`\n            const port =\n                <div\n                    onMouseDown={(e) => {\n                        e.stopPropagation()\n                        dispatch(actions.select({\n                            type: (type + 'put') as ('input' | 'output'),\n                            portId: i,\n                            selectId: id\n                        }))\n                    }}\n                    key={key}\n                    className={`${type}put ${key} ${portKey}`}\n                    onMouseUp={e => {\n                        if (type !== \"in\" || typeof selectId !== \"number\" || !select?.portId) return\n                        const endId = id\n                        const endPort = i\n                        const startId = selectId\n                        const startPort = select.portId\n                        // if connect to same node\n                        if (startId === endId) return\n                        dispatch(actions.addConnection({ startId, startPort, endId, endPort }))\n                    }}\n                >\n                    <div className={`indicator ${(portToConnect === portKey && ' ') || 'invisible'}`}></div>\n                </div>\n            arr.push(port);\n        }\n\n        return (\n            <div className={`${type}puts`}>\n                {arr}\n            </div>\n        );\n    }\n\n    \n\n    useEffect(() => {\n        if (ref.current) {\n            const { offsetHeight, offsetWidth } = ref.current\n            dispatch(actions.nodeSize({ height: offsetHeight, width: offsetWidth, id }))\n        }\n    })\n\n    useEffect(() => {\n        const getPortPos = (type: portType, i: number, elmt: Element) => {\n            const key = `${id}_${type}_${i}`;\n            const x = parseInt(getComputedStyle(elmt).left) + node.pos.x\n            const y = parseInt(getComputedStyle(elmt).top) + node.pos.y\n\n            return {\n                [key]: { x, y }\n            }\n        }\n\n        if (ref.current) {\n            const inputs = Array.from((ref.current.querySelector(\".inputs\") as HTMLDivElement).children);\n            const outputs = Array.from((ref.current.querySelector(\".outputs\") as HTMLDivElement).children);\n            let newPorts = {};\n            newPorts = Object.assign(newPorts, inputs.reduce((acc, elmt, i) => {\n                return Object.assign(acc, getPortPos(portType.in, i + 1, elmt));\n            }, {}));\n            newPorts = Object.assign(newPorts, outputs.reduce((acc, elmt, i) => {\n                return Object.assign(acc, getPortPos(portType.out, i + 1, elmt));\n            }, {}));\n            dispatch(actions.pushPorts(newPorts))\n        }\n\n\n    }, [dispatch, id, node.pos.x, node.pos.y]);\n\n    useEffect(() => {\n        // when add new node shift it to left and up\n        if (ref.current && nodeId - 1 === id && drag) {\n            const { offsetHeight, offsetWidth } = ref.current\n            dispatch(actions.moveNode({ nodeId: id, dx: -offsetWidth * 0.2, dy: -offsetHeight * 0.2 }))\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [])\n\n    let style = {\n        top: pos.y + \"px\",\n        left: pos.x + \"px\",\n        cursor: \"move\",\n    }\n    if (node.isSub) {\n        style = { ...style, ...subnodeStyle }\n    }\n\n    return (\n        <div\n            ref={ref}\n            className={`node-${id} drawflow-node-block-default`\n                + (selectId === id ? ' select' : '')\n                + (node.isSub ? ' subnode' : '')}\n            style={style}\n            onMouseDown={e => {\n                e.stopPropagation()\n                const { clientX, clientY } = e\n                dispatch(actions.select({ type: 'node', selectId: id }))\n                dispatch(actions.setMouseBlockDragPos({ clientX, clientY }))\n            }}\n            onContextMenu={e => {\n                // TODO show delete button\n            }}\n            onDoubleClick={() => {\n                // show node settings\n            }}\n        >\n            {portComponent(portType.in)}\n            <div\n                className=\"drawflow-node-content\"\n            >\n                <Round {...node} />\n            </div>\n            {portComponent(portType.out)}\n            {/* <button\n            style={{\n                display: showButton === id ? \"block\" : \"none\"\n            }}\n            className=\"drawflow-delete\"\n            onMouseDown={(e) => { e.stopPropagation(); event.deleteNode() }}\n        >X</button> */}\n        </div>)\n\n\n}\n\nexport default DrawflowNodeBlock;\n","const makeRandomNames = (length: number, searchWord: string, max = 15, min = 5) => {\n    const result = [];\n    const map = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    for (let j = 0; j < length; j++) {\n        let word = \"\";\n        for (let i = 0; i < Math.floor(Math.random() * (max - min) + min); i++) {\n            word += map.charAt(Math.floor(Math.random() * map.length));\n        }\n        if (searchWord.length > 1) {\n            word += searchWord;\n        }\n        result.push(word);\n    }\n    return result;\n}\n\nconst getGroups = async (number: number) => {\n    const rnd = () => ({\n        type: 'Asd',\n        name: 'assa',\n        value: makeRandomNames(1, \"\", 10, 5)[0],\n    })\n    const rez = []\n    for (let i = 0; i < number; ++i) {\n        rez.push(rnd())\n    }\n    return rez;\n}\n\nexport default getGroups","import { node, NODE_TYPE } from \"../types\";\nimport getFilters from \"./fields.mock\";\nimport { data } from \"../types\"\n\nexport const testNode = (): node => {\n    return {\n        id: 0,\n        \"type\": NODE_TYPE.MIDDLE,\n        \"data\": {\n            \"type\": \"String\",\n            \"name\": \"1qdlCNXqYBsE\",\n            \"value\": \"qqweee\"\n        },\n        \"port\": {\n            \"in\": 1,\n            \"out\": 2\n        },\n        \"pos\": {\n            \"x\": -20,\n            \"y\": 100\n        },\n        \"isSub\": false,\n        height: 0,\n        width: 0\n    }\n}\n\nconst getDummy = async (): Promise<data> => {\n  const data: any = {\n    \"nodes\": {\n    },\n    \"connections\": {\n      \"1_1_3_1\": [],\n      \"4_1_2_1\": []\n    },\n  }\n\n  for (let i = 1; i < 5; ++i) {\n    const node = testNode()\n    node.id = i\n    node.data.name = `Node ${i}`\n    node.pos.x = 100 * i\n    node.pos.y = 50 * i\n    data.nodes[i] = node\n  }\n\n\n  return data\n}\n\n\nconst mock = {\n    getDummy,\n    getFilters,\n}\n\nexport default mock\n","import { configureStore, createAction, createAsyncThunk, createReducer, PayloadAction } from '@reduxjs/toolkit'\nimport { clientPos, flowType, Slices } from '../types'\nimport { addNode, drawflowSlice } from './drawflowSlice'\nimport mock, { testNode } from '../Mock'\nimport { initialState as drawflowInitialState } from './drawflowSlice'\nimport handler from '../components/drawflowHandler'\n\nexport const changeVersion = createAction<number>('versions/changed')\nexport const addNewNode = createAction<clientPos>('addNewNode')\nexport const dragTemplate = createAction<number>('dragTemplate')\n\nconst initialState: flowType = {\n  version: 0,\n  flows: [drawflowInitialState, drawflowInitialState, drawflowInitialState],\n  templates: [],\n  dragTemplate: 0\n}\n\nexport const fetchNodeTemplates = createAsyncThunk('fetchPosts', async () => {\n  return await mock.getFilters(5)\n})\n\nexport const fetchFlowVersion = createAsyncThunk('fetchFlowVersion', async () => {\n  return await mock.getDummy()\n})\n\n\nconst reducer = createReducer(initialState, (builder) => {\n  builder\n    .addCase(changeVersion, (state, { payload }) => {\n      state.version = payload\n    })\n    .addCase(addNewNode, (appState: flowType, { payload: { clientX, clientY } }: PayloadAction<clientPos>) => {\n      if (!appState.dragTemplate) return;\n\n      const state = appState.flows[appState.version]\n      const node = testNode()\n      node.pos = handler.getPos(clientX, clientY, state.config.zoom.value)\n      state.mouseBlockDragPos = { clientX, clientY };\n      addNode(state, node)\n      appState.dragTemplate = undefined\n    })\n    .addCase(dragTemplate, (appState, {payload}) => {\n      appState.dragTemplate = payload\n    })\n    .addCase(fetchNodeTemplates.fulfilled, (state, action) => {\n      state.templates = action.payload\n    })\n    .addCase(fetchFlowVersion.fulfilled, (state, action) => {\n      const { nodes: drawflow, connections } = action.payload;\n      state.flows[state.version] = drawflowSlice(\n        state.flows[state.version],\n        {\n          type: Slices.Drawflow + '/load',\n          payload: { drawflow, connections }\n        })\n    })\n\n    // reducer for drawflow\n    .addMatcher(\n      (action) => action.type.startsWith(Slices.Drawflow),\n      (state, action) => {\n        state.flows[state.version] = drawflowSlice(state.flows[state.version], action)\n      }\n    )\n\n\n})\n\nexport const store = configureStore({\n  reducer\n})\n\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch\n\n// store.subscribe(() => console.log(store.getState()))","import { actions, selectActiveDrawflow } from \"../../redux/drawflowSlice\";\nimport { useAppDispatch, useAppSelector } from \"../../redux/hooks\";\n\nconst DrawflowAdditionalArea = () => {\n    const editLock = useAppSelector(s => selectActiveDrawflow(s).editLock)\n    const dispatch = useAppDispatch()\n\n    return (\n        <div className=\"drawflow-additional\">\n            {!editLock &&\n                <>\n                    <button className=\"drawflow-additional-button\" onClick={() => console.log('clear')}>Clear</button>\n                </>\n            }\n            <button className=\"drawflow-additional-button\" onClick={() => dispatch(actions.setEditLock(!editLock))}>{editLock ? \"UnLock\" : \"Lock\"}</button>\n        </div>\n    );\n}\n\nexport default DrawflowAdditionalArea;\n","import { actions } from \"../../redux/drawflowSlice\";\nimport { useAppDispatch } from \"../../redux/hooks\";\n\nconst DrawflowZoomArea = () => {\n    const dispatch = useAppDispatch()\n\n    return (\n        <div className=\"drawflow-zoom\">\n            <button className=\"drawflow-zoom-button\" onClick={() => dispatch(actions.zoom(true))}>+</button>\n            <button className=\"drawflow-zoom-button\" onClick={() => dispatch(actions.zoom(false))}>-</button>\n            <button className=\"drawflow-zoom-button\" onClick={() => dispatch(actions.zoom(null))}>reset</button>\n        </div>\n    )\n}\n\nexport default DrawflowZoomArea;\n","import handler from \"./drawflowHandler\"\nimport { actions, selectActiveDrawflow } from '../redux/drawflowSlice'\nimport { useAppSelector, useAppDispatch } from '../redux/hooks'\nimport Connection from \"./Connection\";\nimport DrawflowNodeBlock from \"./DrawflowNodeBlock\";\nimport { useEffect } from \"react\";\nimport { addNewNode, fetchFlowVersion } from \"../redux/store\";\nimport DrawflowAdditionalArea from \"./ButtonArea/DrawflowAdditionalArea\";\nimport DrawflowZoomArea from \"./ButtonArea/DrawflowZoomArea\";\nimport { createSelector, createDraftSafeSelector } from \"@reduxjs/toolkit\";\n\nexport const NewPath = () => {\n    const state = useAppSelector(selectActiveDrawflow)\n\n    const { select, config, ports, selectId, newPathDirection } = state;\n    if (!select?.portId) { console.error(`Select port id not set!`); return null }\n    const startKey = `${selectId}_out_${select.portId}`;\n\n    if (!ports[startKey]) { console.error(`Start port key not exist`); return null }\n    if (!newPathDirection) { console.error(`Path direction null`); return null }\n\n    const start = {\n        x: ports[startKey].x,\n        y: ports[startKey].y,\n    }\n    const zoom = config.zoom.value;\n    const { clientX, clientY } = newPathDirection;\n    const end = handler.getPos(clientX, clientY, zoom);\n    const d = handler.createCurvature(start, end);\n\n    return <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"drawflow-connection\"\n    >\n        <Connection.Path\n            d={d}\n        />\n    </svg>\n\n}\n\nexport const ConnectionList = () => {\n    const { connections, ports } = useAppSelector(selectActiveDrawflow)\n\n    const conns = Object.entries(connections).map(([key]) => {\n        // key: fromId_portNum_toId_portNum\n        const arr = key.split(\"_\");\n        const startKey = `${arr[0]}_out_${arr[1]}`;\n        const endKey = `${arr[2]}_in_${arr[3]}`;\n\n        if (!ports[startKey] || !ports[endKey]) {\n            // console.error(`No such connection`, key);\n            return null\n        };\n\n        const start = {\n            x: ports[startKey].x,\n            y: ports[startKey].y,\n        }\n        const end = {\n            x: ports[endKey].x,\n            y: ports[endKey].y,\n        }\n        const d = handler.createCurvature(start, end)\n        return (\n            <div key={key}>\n                <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    className=\"drawflow-connection\"\n                >\n                    <Connection.Path\n                        svgKey={key}\n                        d={d}\n                    />\n                </svg>\n            </div>\n        )\n\n    })\n    return <>{conns}</>\n}\n\nconst selectDrawflow = createDraftSafeSelector(selectActiveDrawflow, (s) => s.drawflow)\n\nexport const NodeList = () => {\n    const drawflow = useAppSelector(selectDrawflow)\n    // console.log(`Render NodeList`)\n\n    return <>{Object.values(drawflow).map((node) => {\n        return <DrawflowNodeBlock\n            key={node.id}\n            id={node.id}\n        />\n    }\n    )}</>\n}\n\n\nexport const Drawflow = () => {\n    const { select, config: { canvasTranslate: { x, y }, zoom }, newPathDirection }\n        = useAppSelector(selectActiveDrawflow)\n    // console.log(`Render Drawflow`)\n\n    const dispatch = useAppDispatch()\n\n    useEffect(() => {\n        dispatch(fetchFlowVersion())\n    }, [dispatch])\n\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === \"Delete\") {\n                if (select?.type === \"path\") {\n                    dispatch(actions.deletePath())\n                }\n                else {\n                    dispatch(actions.deleteNode())\n                }\n            }\n        }\n        document.addEventListener(\"keydown\", handleKeyDown);\n        return () => {\n            document.removeEventListener(\"keydown\", handleKeyDown);\n        }\n    }, [dispatch, select?.type])\n\n\n    return (\n        <div\n            id=\"drawflow\"\n            className=\"parent-drawflow\"\n            onMouseDown={(e) => {\n                if (!e.currentTarget.classList.contains(\"parent-drawflow\")) return;\n                dispatch(actions.canvasDrag(true))\n                dispatch(actions.unSelect())\n            }}\n            onMouseUp={() => dispatch(actions.canvasMouseUp())}\n            onMouseMove={(e) => {\n                const { clientX, clientY, movementX, movementY } = e\n                dispatch(actions.canvasMouseMove({ clientX, clientY, movementX, movementY }))\n            }}\n            onMouseEnter={(e) => {\n                const { clientX, clientY } = e\n                dispatch(addNewNode({ clientX, clientY }))\n            }}\n        >\n            <DrawflowAdditionalArea />\n            <DrawflowZoomArea />\n            <div\n                className=\"drawflow\"\n                style={{\n                    transform: `translate(${x}px, ${y}px) scale(${zoom.value})`\n                }}\n            >\n                <NodeList />\n                <ConnectionList />\n                {newPathDirection && <NewPath />}\n            </div>\n        </div>\n    )\n}","import { useEffect } from 'react';\nimport { useAppDispatch, useAppSelector } from '../redux/hooks';\nimport { dragTemplate, fetchNodeTemplates } from '../redux/store';\n\ntype Props = {\n    searchWord: string\n}\n\nconst FilterList = (props: Props) => {\n    const { searchWord } = props;\n    const list = useAppSelector(s => s.templates)\n    const dispatch = useAppDispatch()\n    const searchArr = searchWord.toLowerCase().split(\" \").filter(item => item.length > 0);\n\n\n    useEffect(() => {\n        dispatch(fetchNodeTemplates())\n    }, [dispatch])\n\n    return (\n        <div\n            className=\"drawflow-node-list-wrap\"\n        >\n            {list.map((item, idx) => {\n                const { name, type, value } = item\n                const label = JSON.stringify(item, null, 2)\n\n                return (\n                    (searchArr.find(word => label.toLowerCase().includes(word)) || !searchArr.length) &&\n                    <div\n                        key={\"drawflow-sidemenu-block-\" + idx}\n                        className=\"drawflow-node-block\"\n                        onMouseDownCapture={(e) => {\n                            dispatch(dragTemplate(1))\n                        }}\n                    >\n                        <pre>{`Type: ${type}\\nValue: ${value + name}`}</pre>\n                    </div>\n                );\n            })}\n        </div>\n    );\n}\n\nexport default FilterList;\n","import { useEffect, useState } from 'react';\nimport { Drawflow } from './components/DrawflowHook';\nimport FilterList from \"./components/FilterList\";\nimport { useAppDispatch } from './redux/hooks';\nimport { changeVersion, fetchFlowVersion } from './redux/store';\n\nimport './drawflow.scss'\nimport { actions } from './redux/drawflowSlice';\n\nfunction App() {\n\n  const [searchWord, setSearchWord] = useState(\"\");\n  const dispatch = useAppDispatch()\n  // console.log('Render App')\n  useEffect(() => {\n    dispatch(actions.align())\n  }, [dispatch])\n\n\n  return (\n    <div className=\"App\">\n      <div className=\"drawflow-node-list\">\n        <div className=\"drawflow-node-list-search\">\n          <input\n            type=\"text\"\n            placeholder=\"Search templates\"\n            onChange={e => { setSearchWord(e.target.value) }}\n          />\n        </div>\n        <div className=\"drawflow-node-list-flex\">\n          <FilterList\n            searchWord={searchWord}\n          />\n        </div>\n      </div>\n      <div className=\"flow\">\n        <div>\n          <button onClick={() => dispatch(fetchFlowVersion())}>Fetch flow version</button>\n\n          <button onClick={() => dispatch(changeVersion(0))}>Version 1</button>\n          <button onClick={() => dispatch(changeVersion(1))}>Version 2</button>\n          <button onClick={() => dispatch(changeVersion(2))}>Version 3</button>\n          <button onClick={() => dispatch(actions.align())}>Align</button>\n        </div>\n        <Drawflow />\n      </div>\n    </div>\n  )\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n// import reportWebVitals from './reportWebVitals';\n\nimport { store } from './redux/store'\nimport { Provider } from 'react-redux'\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals();\n"],"sourceRoot":""}