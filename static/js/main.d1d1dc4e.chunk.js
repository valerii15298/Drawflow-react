(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{40:function(t,e,n){},41:function(t,e,n){"use strict";n.r(e);var o,i,r=n(0),c=n.n(r),a=n(17),s=n.n(a),u=n(4),l=n(2),d=n(5),f=n(7),h=function(){var t=document.querySelector(".drawflow"),e=t.getBoundingClientRect();return{x:e.x,y:e.y,width:t.clientWidth,height:t.clientHeight}},b={createCurvature:function(t,e){var n=(t.y-e.y)/2,o=t.x-e.x;return"M ".concat(t.x," ").concat(t.y," v ").concat(-n," h ").concat(-o," v ").concat(-n," ")},getCanvasInfo:h,getPos:function(t,e,n){var o=h(),i=o.x,r=o.y,c=o.width,a=o.height;return{x:t*(c/(c*n))-i*(c/(c*n)),y:e*(a/(a*n))-r*(a/(a*n))}},findIndexByElement:function(t){for(var e=t.parentElement,n=Array.from(e.childNodes),o=0;o<n.length;o++)if(n[o]===t)return o;return-1},getPortPosWithZoom:function(t,e,n){var o=b.getCanvasInfo(),i=1/n;return{x:t.width/2+(e.x-o.x)*i,y:t.height/2+(e.y-o.y)*i}}},p=b;!function(t){t.START="START",t.MIDDLE="MIDDLE",t.END="END"}(o||(o={})),function(t){t.Drawflow="drawflow"}(i||(i={}));var v,g;!function(t){t.NODE_SETTINGS="NODE_SETTINGS",t.GROUP_SETTINGS="GROUP_SETTINGS"}(v||(v={})),function(t){t.in="in",t.out="out"}(g||(g={}));var j,y,O,m,w,x,k,S,N,I,C,P,D,M,_,T,E,L,W,X,Y,z=n(8),V=n(18),A=n(19),B=n(20),R=n(21),U=n.n(R),J=function(){function t(e,n){Object(A.a)(this,t),this.id=void 0,this.state=void 0,this.flow=void 0,this.nodeState=void 0,this.spacingX=40,this.spacingY=60,this.id=e,this.flow=n,this.state=n.state,this.nodeState=this.state.drawflow[this.id]}return Object(B.a)(t,[{key:"head",get:function(){return this.nodeState.head}},{key:"lane",get:function(){return this.nodeState.lane}},{key:"port",get:function(){return this.nodeState.port}},{key:"portInPos",get:function(){var t,e=this;return null===(t=Object.entries(this.state.ports).find((function(t){var n=Object(u.a)(t,2),o=n[0];n[1];return o==="".concat(e.id,"_in_1")})))||void 0===t?void 0:t[1]}},{key:"outPorts",get:function(){var t=this;return Object.entries(this.state.ports).filter((function(e){var n=Object(u.a)(e,2),o=n[0];n[1];return o.startsWith("".concat(t.id,"_out"))}))}},{key:"parent",get:function(){var t,e=this,n=null===(t=Object.keys(this.state.connections).find((function(t){return t.split("_")[2]===e.id.toString()})))||void 0===t?void 0:t.split("_")[0];return n?this.flow.getNode(Number(n)):null}},{key:"parentConnection",get:function(){var t=this;return Object.keys(this.state.connections).find((function(e){var n,o=e.split("_").map(Number);return o[0]===(null===(n=t.parent)||void 0===n?void 0:n.id)&&o[2]===t.id&&1===o[3]}))}},{key:"totalWidth",get:function(){return!1===this.nodeState.visible?0:Math.max(this.width+this.subnodesWidth,this.leftWidth+this.rightWidth)}},{key:"childrenTotalWidth",get:function(){var t=this.out1;if(!t.length)return 0;var e=0;return t.forEach((function(t){e+=t.totalWidth})),e+this.spacingX*(t.length-1)}},{key:"alignChildren",value:function(){var t=this,e=this.out1;this.update({isSub:!1,port:{out:2}});var n,o=this.pos.x-(this.leftWidth-this.width/2),i=Object(V.a)(e);try{for(i.s();!(n=i.n()).done;){var r=n.value,c=o+(r.leftWidth-r.width/2);r.setPos({x:c,y:this.pos.y+this.height+this.spacingY}),!1!==r.nodeState.visible&&(o+=r.totalWidth+this.spacingX),r.alignChildren()}}catch(s){i.e(s)}finally{i.f()}var a=this.subnodes;a.length&&(o=this.pos.x+this.width+this.spacingX,a.forEach((function(e){e.update({isSub:!0,port:{out:1}}),e.setPos({x:o,y:t.pos.y+(t.height/2-e.height/2)}),delete t.state.ports["".concat(e.id,"_out_2")],o+=e.width+t.spacingX})))}},{key:"leftWidth",get:function(){if(!1===this.nodeState.visible)return 0;var t=this.out1,e=this.childrenTotalWidth,n=this.width/2;if(!t.length)return n;var o=t[0].leftWidth,i=o+(e-o-t[t.length-1].rightWidth)/2;return Math.max(i,n)}},{key:"rightWidth",get:function(){if(!1===this.nodeState.visible)return 0;var t=this.out1,e=this.childrenTotalWidth,n=this.width/2+this.subnodesWidth;if(!t.length)return n;var o=t[0].leftWidth,i=t[t.length-1].rightWidth,r=i+(e-o-i)/2;return Math.max(r,n)}},{key:"all2Successors",get:function(){var t=this.subnodes,e=this.out1,n=Object(z.a)(e);return t.forEach((function(t){return n.push(t)})),this.out1.forEach((function(t){return n.push(t)})),n}},{key:"allSuccessors",get:function(){var t=[].concat(Object(z.a)(this.out1),Object(z.a)(this.subnodes)),e=Object(z.a)(t);return t.forEach((function(t){return e.push.apply(e,Object(z.a)(t.allSuccessors))})),e}},{key:"toggleVisibility",value:function(t){var e=this;this.update({visible:t}),this.parentConnection&&(this.state.connections[this.parentConnection]=t),this.outConnections.forEach((function(n){e.state.connections[n]=t}))}},{key:"toggleChildrenVisibility",value:function(){var t,e=null===(t=this.nodeState.childrenVisibility)||void 0===t||t;this.update({childrenVisibility:!e});var n=this.subnodes;this.allSuccessors.forEach((function(t){n.includes(t)||t.toggleVisibility(!e)}))}},{key:"toggleSubnodesVisibility",value:function(){var t,e=null===(t=this.nodeState.subnodesVisibility)||void 0===t||t;this.update({subnodesVisibility:!e}),this.subnodes.forEach((function(t){t.toggleVisibility(!e)}))}},{key:"outConnections",get:function(){var t=this;return Object.entries(this.state.connections).filter((function(e){return Object(u.a)(e,1)[0].split("_").map(Number)[0]===t.id})).map((function(t){return t[0]}))}},{key:"children",value:function(t){var e=this;return Object.keys(this.state.connections).filter((function(n){return n.split("_")[0]===e.id.toString()&&n.split("_")[1]===t.toString()})).map((function(t){return e.flow.getNode(Number(t.split("_")[2]))}))}},{key:"out1",get:function(){return this.children(1)}},{key:"firstSubnode",get:function(){return this.children(2)[0]}},{key:"subnodes",get:function(){var t,e;return(null===(t=this.firstSubnode)||void 0===t||null===(e=t.flowLine)||void 0===e?void 0:e.flowLineNodes)||[]}},{key:"subnodesWidth",get:function(){var t=this;return this.subnodes.reduce((function(e,n){return e+n.width+t.spacingX}),0)}},{key:"isSub",get:function(){return null!==this.complexParentNode}},{key:"complexParentNode",get:function(){var t=this.parent;return t?t.firstSubnode===this?t:t.complexParentNode:null}},{key:"flowLine",get:function(){for(var t=[this],e=this,n=e.firstSubnode;1===e.out1.length;)n=n||e.firstSubnode,e=e.out1[0],t.push(e);return e.out1.length>1?null:{flowLineNodes:t,hasSubnodes:n}}},{key:"height",get:function(){return this.state.drawflow[this.id].height}},{key:"width",get:function(){return this.state.drawflow[this.id].width}},{key:"pos",get:function(){return this.state.drawflow[this.id].pos}},{key:"setPos",value:function(t){var e=this.pos,n=t.x,o=t.y;this.flow.moveNode({nodeId:this.id,dx:n-e.x,dy:o-e.y})}},{key:"update",value:function(t){var e=U.a.merge(this.nodeState,t);Object.assign(this.nodeState,e)}}]),t}(),F=function(){function t(e){var n=this;Object(A.a)(this,t),this.state=void 0,this.nodes={},this.distanceToConnect=100,this.distanceToDisconnect=0,this.state=e;var o=this.state.drawflow;Object.keys(o).map((function(t){return n.nodes[Number(t)]=new J(Number(t),n)}))}return Object(B.a)(t,[{key:"heads",get:function(){return Object.entries(this.nodes).filter((function(t){var e=Object(u.a)(t,2);e[0];return!e[1].parent})).map((function(t){return t[1]}))}},{key:"getNode",value:function(t){return this.nodes[t]}},{key:"alignAll",value:function(){this.setLaneNumbers(),this.heads.forEach((function(t){t.alignChildren()}))}},{key:"allowConnection",value:function(t){var e=t.startId,n=t.startPort,o=t.endId,i=this.getNode(o),r=this.getNode(e),c=2===n;if(i.parent||!1===r.nodeState.visible)return!1;var a=i.flowLine;return!((c||r.isSub)&&(!a||a.hasSubnodes))}},{key:"addConnection",value:function(t){var e=t.startId,n=t.startPort,o=t.endId,i=t.endPort,r=this.getNode(o),c=this.getNode(e),a=2===n;if(r.parent||!1===c.nodeState.visible)return!1;var s=r.flowLine;if((a||c.isSub)&&(!s||s.hasSubnodes))return!1;var u=null;if(a&&c.subnodes.length){if(!1===c.nodeState.subnodesVisibility){e=c.subnodes[c.subnodes.length-1].id,n=1;var l="".concat(e,"_").concat(n,"_").concat(o,"_").concat(i);return this.state.connections[l]=!0,void s.flowLineNodes.forEach((function(t){return t.toggleVisibility(!1)}))}u=c.subnodes[0]}if(c.isSub&&c.out1.length&&(u=c.out1[0]),null!==u){var d="".concat(e,"_").concat(n,"_").concat(u.id,"_1");delete this.state.connections[d];var f=s.flowLineNodes,h=f[f.length-1],b="".concat(h.id,"_1_").concat(u.id,"_1");this.state.connections[b]=!0}var p="".concat(e,"_").concat(n,"_").concat(o,"_").concat(i);this.state.connections[p]=!0}},{key:"moveNode",value:function(t){var e=t.dx,n=t.dy,o=t.nodeId;this.state.drawflow[o].pos.x+=e,this.state.drawflow[o].pos.y+=n}},{key:"dragNode",value:function(t){var e=t.dx,n=t.dy,o=t.nodeId;this.moveNode({dx:e,dy:n,nodeId:o}),this.toggleAvailablePortToConnect(o)}},{key:"toggleAvailablePortToConnect",value:function(t){var e=this,n=Date.now();if(!(this.state.computing&&n-this.state.computing<100)&&(this.state.computing=n,this.state.config.drag)){var o=this.getNode(t),i=o.head;o.parentConnection&&(delete this.state.connections[o.parentConnection],this.alignAll());var r=o.portInPos;if(r){var c=[];if(Object.entries(this.nodes).filter((function(t){var e=Object(u.a)(t,2),n=(e[0],e[1]);return n.head!==i&&!1!==n.nodeState.visible})).forEach((function(n){var o=Object(u.a)(n,2),i=o[0],a=o[1];Number(i)!==t&&a.outPorts.forEach((function(t){var n=Object(u.a)(t,2),o=n[0],i=n[1],a=Math.hypot(r.x-i.x,r.y-i.y);a<e.distanceToConnect&&c.push({key:o,distance:a})}))})),c.sort((function(t,e){return t.distance-e.distance})),c.length){var a=c.shift();a.distance<this.distanceToConnect?this.state.portToConnect=a.key:this.state.portToConnect=void 0}else this.state.portToConnect=void 0}}}},{key:"setLaneNumbers",value:function(){var t=this,e=this.heads;e.forEach((function(t){return t.update({head:t.id,lane:0})}));for(var n=function(){var t=[];e.forEach((function(e){var n=e.lane+1,o=e.subnodes,i=e.head;if(void 0!==i){if(o.length){var r,c=Object(V.a)(o);try{for(c.s();!(r=c.n()).done;){r.value.update({lane:n++,head:i})}}catch(s){c.e(s)}finally{c.f()}}var a=e.children(1);a.forEach((function(t){return t.update({head:i,lane:n})})),t.push.apply(t,Object(z.a)(a))}else console.error("head is undefined in setLaneNumbers")})),e=t};e.length;)n();this.heads.forEach((function(e){for(var n=e.head,o=function(e,o,i){(i=Object.values(t.nodes).filter((function(t){return t.lane===e&&t.head===n}))).forEach((function(t){t.update({positionNumber:o++})})),r=o,c=i},i=0,r=0,c=[e];c.length;++i)o(i,r,c)}))}}]),t}(),K={nodeId:1,canvasDrag:!1,config:{drag:!1,connectionsLabelEnable:!1,canvasTranslate:{x:0,y:0},zoom:{value:1,max:2,min:.5,tick:.1}},drawflow:{},connections:{},connectionsLabel:{},ports:{},select:null,selectId:null,selectPath:null,showButton:null,newPathDirection:null,modalType:null,editLock:!1,mouseBlockDragPos:{clientX:void 0,clientY:void 0}},G=function(t){new F(t).alignAll()},q=Object(f.e)({name:i.Drawflow,initialState:K,reducers:{setEditLock:function(t,e){var n=e.payload;t.editLock=n},align:G,moveNode:function(t,e){return new F(t).dragNode(e.payload)},setMouseBlockDragPos:function(t,e){var n=e.payload;t.mouseBlockDragPos=n},unSelect:function(t){t.config.drag=!1,t.select=null,t.selectId=null,t.showButton=null},select:function(t,e){var n=e.payload,o=n.type,i=n.selectId;t.config.drag="node"===o,t.select=n,t.selectId=null!==i&&void 0!==i?i:null},moveCanvas:function(t,e){var n=e.payload,o=n.movementX,i=n.movementY;t.canvasDrag&&(t.config.canvasTranslate.x+=o,t.config.canvasTranslate.y+=i)},canvasDrag:function(t,e){var n=e.payload;t.canvasDrag=n},canvasMouseMove:function(t,e){var n,o=e.payload,i=o.movementX,r=o.movementY,c=o.clientX,a=o.clientY;if(t.clientCurrentMousePos={clientX:c,clientY:a},t.canvasDrag)t.config.canvasTranslate.x+=i,t.config.canvasTranslate.y+=r;else if((null===(n=t.select)||void 0===n?void 0:n.type)===g.out)t.newPathDirection={clientX:c,clientY:a};else if(t.config.drag&&"number"===typeof t.selectId){var s=t.selectId,u=t.mouseBlockDragPos,l=u.clientX,d=u.clientY;t.mouseBlockDragPos={clientX:c,clientY:a};var f=t.config.zoom.value,h=(c-l)/f,b=(a-d)/f;new F(t).dragNode({nodeId:s,dy:b,dx:h})}},canvasMouseUp:function(t){var e,n=new F(t);if(t.portToConnect){var o=t.portToConnect.split("_").map((function(t){return Number(t)})),i=Object(u.a)(o,3),r=i[0],c=i[2],a=Number(t.selectId);n.addConnection({startId:r,startPort:c,endId:a,endPort:1})}t.portToConnect=void 0,t.newPathDirection=null,t.canvasDrag=!1,t.config.drag=!1,(null===(e=t.select)||void 0===e?void 0:e.type)===g.out&&(t.select=null),n.alignAll()},deleteNode:function(t){var e=t.connections,n=t.drawflow,o=t.ports,i=t.selectId,r=t.select;i&&"number"===typeof i&&"node"===(null===r||void 0===r?void 0:r.type)&&(Object.keys(e).reduce((function(t,n){var o=n.split("_").map((function(t){return parseInt(t)}));return 1*o[0]!==i&&1*o[2]!==i||delete e[n],null}),null),Object.keys(o).reduce((function(t,e){return 1*e.split("_").map((function(t){return parseInt(t)}))[0]===i&&delete o[e],null}),null),delete n[i],t.select=null,t.selectId=null,t.showButton=null)},deletePath:function(t){var e=t.selectId,n=t.connections,o=t.select;"string"===typeof e&&"path"===(null===o||void 0===o?void 0:o.type)&&delete n[e]},load:function(t,e){var n=e.payload;return Object.assign(t,K),t.drawflow=n.drawflow,t.nodeId=Object.keys(n.drawflow).length+1,t.connections=n.connections,t},portMouseUp:function(t,e){var n=e.payload,o=n.nodeId,i=n.portId,r=n.PortType,c=t.selectId,a=t.select;if(r===g.in&&"number"===typeof c&&(null===a||void 0===a?void 0:a.portId)){var s=o,u=i,l=c,d=a.portId;if(l!==s)new F(t).addConnection({startId:l,startPort:d,endId:s,endPort:u})}},clear:function(){return K},pushPorts:function(t,e){var n=e.payload;t.ports=Object(d.a)(Object(d.a)({},t.ports),n)},zoom:function(t,e){var n=e.payload,o=t.config.zoom,i=o.value,r=o.max,c=o.min,a=o.tick,s=i+(n?a:-a);s<=r&&s>=c&&(o.value=s),null===n&&(t.config.canvasTranslate={x:0,y:0},o.value=1)},nodeSize:function(t,e){var n=e.payload,o=n.height,i=n.width,r=n.id;t.drawflow[r].height=o,t.drawflow[r].width=i},toggleSubnodes:function(t,e){var n=e.payload.id;new F(t).getNode(n).toggleSubnodesVisibility(),G(t)},toggleChildren:function(t,e){var n=e.payload.id;new F(t).getNode(n).toggleChildrenVisibility(),G(t)},copyNode:function(t){var e;"node"===(null===(e=t.select)||void 0===e?void 0:e.type)&&"number"===typeof t.select.selectId&&(t.nodeToCopyId=t.select.selectId)},insertCopiedNode:function(t){if(void 0!==t.nodeToCopyId){var e=t.clientCurrentMousePos,n=e.clientX,o=e.clientY,i=JSON.parse(JSON.stringify(t.drawflow[t.nodeToCopyId]));i.pos=p.getPos(n,o,t.config.zoom.value),t.drawflow[t.nodeId]=Object(d.a)(Object(d.a)({},i),{},{id:t.nodeId,height:0,width:0}),++t.nodeId}}}}),H=q.actions,Z=q.reducer,$=function(t){return t.flows[t.version]},Q=n(16),tt=function(){return Object(Q.b)()},et=Q.c,nt=n(6),ot=n.n(nt),it=n(11),rt=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=[],r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<t;c++){for(var a="",s=0;s<Math.floor(Math.random()*(n-o)+o);s++)a+=r.charAt(Math.floor(Math.random()*r.length));e.length>1&&(a+=e),i.push(a)}return i},ct=function(){var t=Object(it.a)(ot.a.mark((function t(e){var n,o,i;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=function(){return{type:"Asd",name:"assa",value:rt(1,"",10,5)[0]}},o=[],i=0;i<e;++i)o.push(n());return t.abrupt("return",o);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),at=function(){return{id:0,type:o.MIDDLE,data:{type:"Node type",name:"Node name",value:"Node value"},port:{in:1,out:2},pos:{x:-20,y:100},isSub:!1,height:0,width:0}},st={getDummy:function(){var t=Object(it.a)(ot.a.mark((function t(){var e,n,o;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e={nodes:{},connections:{"1_1_3_1":!0,"4_1_2_1":!0}},n=1;n<5;++n)(o=at()).id=n,o.data.name="Node ".concat(n),o.pos.x=100*n,o.pos.y=50*n,e.nodes[n]=o;return t.abrupt("return",e);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),getFilters:ct},ut=Object(f.b)("versions/changed"),lt=Object(f.b)("addNewNode"),dt=Object(f.b)("dragTemplate"),ft={version:0,flows:[K,K,K],templates:[],dragTemplate:0},ht=Object(f.c)("fetchPosts",Object(it.a)(ot.a.mark((function t(){var e;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,st.getFilters(5);case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)})))),bt=Object(f.c)("fetchFlowVersion",Object(it.a)(ot.a.mark((function t(){return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,st.getDummy();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))),pt=Object(f.d)(ft,(function(t){t.addCase(ut,(function(t,e){var n=e.payload;t.version=n})).addCase(lt,(function(t,e){var n=e.payload,o=n.clientX,i=n.clientY;if(t.dragTemplate){var r=t.flows[t.version],c=at();c.pos=p.getPos(o,i,r.config.zoom.value),r.mouseBlockDragPos={clientX:o,clientY:i},r.drawflow[r.nodeId]=Object(d.a)(Object(d.a)({},c),{},{id:r.nodeId,height:0,width:0}),r.selectId=r.nodeId++,r.select={type:"node",selectId:r.selectId},r.config.drag=!0,t.dragTemplate=void 0}})).addCase(dt,(function(t,e){var n=e.payload;t.dragTemplate=n})).addCase(ht.fulfilled,(function(t,e){t.templates=e.payload})).addCase(bt.fulfilled,(function(t,e){var n=e.payload,o=n.nodes,r=n.connections;t.flows[t.version]=Z(t.flows[t.version],{type:i.Drawflow+"/load",payload:{drawflow:o,connections:r}})})).addMatcher((function(t){return t.type.startsWith(i.Drawflow)}),(function(t,e){t.flows[t.version]=Z(t.flows[t.version],e)}))})),vt=Object(f.a)({reducer:pt}),gt=n(3),jt=n(1),yt=gt.b.div(j||(j=Object(l.a)(["\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  padding: 5px 10px;\n  background-color: #ddd;\n  font-weight: bold;\n  z-index: 1;\n"]))),Ot=gt.b.button(y||(y=Object(l.a)(["\n  background-color: #333;\n  color: #fff;\n  border-radius: 4px;\n"]))),mt=function(){var t=et((function(t){return $(t).editLock})),e=tt();return Object(jt.jsxs)(yt,{children:[!t&&Object(jt.jsx)(Ot,{children:"Clear"}),Object(jt.jsx)(Ot,{onClick:function(){return e(H.setEditLock(!t))},children:t?"UnLock":"Lock"})]})},wt=gt.b.div(O||(O=Object(l.a)(["\n  position: absolute;\n  bottom: 10px;\n  right: 10px;\n  padding: 5px 10px;\n  background-color: #ddd;\n  font-weight: bold;\n  z-index: 1;\n"]))),xt=gt.b.button(m||(m=Object(l.a)(["\n  background-color: #333;\n  color: #fff;\n  border-radius: 4px;\n  padding: 3px 10px;\n"]))),kt=function(){var t=tt();return Object(jt.jsxs)(wt,{children:[Object(jt.jsx)(xt,{onClick:function(){return t(H.zoom(!0))},children:"+"}),Object(jt.jsx)(xt,{onClick:function(){return t(H.zoom(!1))},children:"-"}),Object(jt.jsx)(xt,{onClick:function(){return t(H.zoom(null))},children:"reset"})]})},St=function(t){var e=t.property,n=t.svgKey,o=t.i,i=t.editLock;return Object(jt.jsx)("circle",Object(d.a)(Object(d.a)({},e),{},{r:6,onMouseDown:function(e){i||t.select(e,{svgKey:n,i:o})}}))},Nt=function(){var t=et($),e=t.select,n=t.config,o=t.ports,i=t.selectId,r=t.newPathDirection;if(!(null===e||void 0===e?void 0:e.portId))return console.error("Select port id not set!"),null;var c="".concat(i,"_out_").concat(e.portId);if(!o[c])return console.error("Start port key not exist"),null;if(!r)return console.error("Path direction null"),null;var a={x:o[c].x,y:o[c].y},s=n.zoom.value,u=r.clientX,l=r.clientY,d=p.getPos(u,l,s),f=p.createCurvature(a,d);return Object(jt.jsx)(St,{d:f})},It=n(9),Ct=Object(It.b)(It.c,U.a.isEqual),Pt=function(t){return et(Object(r.useMemo)((function(){return Ct((function(e){return $(e).ports[t]}),(function(t){return t}))}),[t]))},Dt=n(10),Mt=gt.b.div(w||(w=Object(l.a)(["\n  max-height: 100%;\n  overflow: hidden;\n"]))),_t=function(t){return Object(jt.jsx)(Mt,{children:JSON.stringify(t,null,2)})},Tt=100,Et=60,Lt=gt.b.div(x||(x=Object(l.a)(["\n  width: 15px;\n  height: 15px;\n  border-radius: 60px;\n  background-color: #217ce8;\n  opacity: ",";\n  transform: scale(",");\n  transition: all 0.3s cubic-bezier(0.05, 0.03, 0.35, 1);\n"])),(function(t){return t.visible?1:0}),(function(t){return t.visible?1:0})),Wt=gt.b.div(k||(k=Object(l.a)(["\n  height: 15px;\n  width: 15px;\n  border-radius: 50%;\n  background-color: red;\n  position: absolute;\n"]))),Xt=Object(gt.b)(Wt)(S||(S=Object(l.a)(["\n  left: 50%;\n  top: 100%;\n  transform: translate(-50%, -50%);\n  ","\n"])),(function(t){return t.isSub&&Object(gt.a)(N||(N=Object(l.a)(["\n      left: 100%;\n      top: 50%;\n    "])))})),Yt=Object(gt.b)(Wt)(I||(I=Object(l.a)(["\n  left: 100%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  ","\n"])),(function(t){return t.isSub&&Object(gt.a)(C||(C=Object(l.a)(["\n      display: none;\n    "])))})),zt=Object(gt.b)(Wt)(P||(P=Object(l.a)(["\n  left: 50%;\n  top: 0;\n  transform: translate(-50%, -50%);\n\n  ","\n"])),(function(t){return t.isSub&&Object(gt.a)(D||(D=Object(l.a)(["\n      left: 0;\n      top: 50%;\n    "])))})),Vt=(M={},Object(Dt.a)(M,g.in,[zt]),Object(Dt.a)(M,g.out,[Xt,Yt]),M),At=function(t){for(var e=t.id,n=t.port,o=t.type,i=tt(),c=et((function(t){return $(t).portToConnect})),a=function(t){return et(Object(r.useMemo)((function(){return Ct((function(e){return $(e).drawflow[t].isSub}),(function(t){return t}))}),[t]))}(e),s=[],u=function(t){var n="".concat(o,"put-").concat(t),r="".concat(e,"_").concat(o,"_").concat(t),u=Vt[o][t-1],l=Object(jt.jsx)(u,{isSub:a,onMouseDown:function(n){n.stopPropagation(),i(H.select({type:o,portId:t,selectId:e}))},onMouseUp:function(n){i(H.portMouseUp({nodeId:e,portId:t,PortType:o}))},children:Object(jt.jsx)(Lt,{visible:!(c!==r)})},n);s.push(l)},l=1;l<=n[o];l++)u(l);return Object(jt.jsx)("div",{className:"".concat(o,"puts"),children:s})},Bt=gt.b.div(_||(_=Object(l.a)(["\n  display: inline-block;\n  position: absolute;\n  padding: 5px;\n  width: 200px;\n  min-height: 60px;\n  background-color: #d3d3d3;\n  z-index: 1;\n  cursor: move;\n\n  ","\n  ",";\n"])),(function(t){return t.isSub&&Object(gt.a)(T||(T=Object(l.a)(["\n      height: ","px;\n      width: ","px;\n    "])),Et,Tt)}),(function(t){return t.selected&&Object(gt.a)(E||(E=Object(l.a)(["\n      box-shadow: 0 2px 15px 2px #cacaca;\n      z-index: 2;\n    "])))})),Rt=function(t){var e=t.id;console.log("Render node id: ".concat(e));var n=et(Object(r.useMemo)((function(){return Ct((function(t){return $(t).config.drag}),(function(t){return t}))}),[])),o=et((function(t){return $(t).nodeId})),i=function(t){return et(Object(r.useMemo)((function(){return Ct((function(e){return $(e).drawflow[t].pos}),(function(t){return t}))}),[t]))}(e),c=function(t){return et(Object(r.useMemo)((function(){return Ct((function(e){return $(e).selectId===t}),(function(t){return t}))}),[t]))}(e),a=tt(),s=Object(r.useRef)(null),u=function(t){return et(Object(r.useMemo)((function(){return Ct((function(e){var n=JSON.parse(JSON.stringify($(e).drawflow[t]));return delete n.pos,n}),(function(t){return t}))}),[t]))}(e),l=u.port;return Object(r.useEffect)((function(){if(s.current){var t=s.current,n=t.offsetHeight,o=t.offsetWidth;a(H.nodeSize({height:n,width:o,id:e})),a(H.align())}}),[a,e,u]),Object(r.useEffect)((function(){var t=function(t,n,o){var r="".concat(e,"_").concat(t,"_").concat(n),c=parseInt(getComputedStyle(o).left)+i.x,a=parseInt(getComputedStyle(o).top)+i.y;return Object(Dt.a)({},r,{x:c,y:a})};if(s.current){var n=Array.from(s.current.querySelector(".inputs").children),o=Array.from(s.current.querySelector(".outputs").children),r={};r=Object.assign(r,n.reduce((function(e,n,o){return Object.assign(e,t(g.in,o+1,n))}),{})),r=Object.assign(r,o.reduce((function(e,n,o){return Object.assign(e,t(g.out,o+1,n))}),{})),a(H.pushPorts(r))}}),[a,e,i]),Object(r.useEffect)((function(){if(s.current&&o-1===e&&n){var t=s.current,i=t.offsetHeight,r=t.offsetWidth;a(H.moveNode({nodeId:e,dx:.2*-r,dy:.2*-i}))}}),[]),Object(jt.jsxs)(Bt,{selected:c,ref:s,style:{left:i.x,top:i.y},isSub:u.isSub,onMouseDown:function(t){t.stopPropagation();var n=t.clientX,o=t.clientY;a(H.select({type:"node",selectId:e})),a(H.setMouseBlockDragPos({clientX:n,clientY:o}))},onContextMenu:function(t){},onDoubleClick:function(){},children:[Object(jt.jsx)(_t,Object(d.a)(Object(d.a)({},u),i)),!u.isSub&&Object(jt.jsxs)(jt.Fragment,{children:[Object(jt.jsx)("div",{onClick:function(){a(H.toggleSubnodes({id:e}))},children:"toggle sub"}),Object(jt.jsx)("div",{onClick:function(){a(H.toggleChildren({id:e}))},children:"toggle children"})]}),Object(jt.jsx)(At,{id:e,port:l,type:g.in}),Object(jt.jsx)(At,{id:e,port:l,type:g.out}),Object(jt.jsx)("button",{style:{},onMouseDown:function(t){t.stopPropagation()},children:"X"})]})},Ut=function(){console.log("Render NodeList");var t=et(Object(r.useMemo)((function(){return Ct((function(t){var e=$(t).drawflow;return Object.entries(e).filter((function(t){var e=Object(u.a)(t,2);return e[0],!1!==e[1].visible})).map((function(t){var e=Object(u.a)(t,1)[0];return Number(e)}))}),(function(t){return t}))}),[]));return Object(jt.jsx)(jt.Fragment,{children:t.map((function(t){return Object(jt.jsx)(Rt,{id:t},t)}))})},Jt=gt.b.svg(L||(L=Object(l.a)(["\n  position: absolute;\n  overflow: visible;\n"]))),Ft=gt.b.path(W||(W=Object(l.a)(["\n  :hover {\n    stroke-width: 6px;\n    stroke: purple;\n    cursor: pointer;\n  }\n  fill: none;\n  stroke-width: ","px;\n  stroke: steelblue;\n"])),(function(t){return t.theme.selected?7:6})),Kt=function(t){var e=t.svgKey,n=t.d,o=et((function(t){return $(t).selectId})),i=tt();return Object(jt.jsx)(Jt,{children:Object(jt.jsx)(Ft,{theme:{selected:o===e&&e},d:n,onMouseDown:function(t){e&&(t.stopPropagation(),i(H.select({type:"path",selectId:e})))}})})},Gt=function(t){var e=t.id,n=e.split("_").map(Number),o="".concat(n[0],"_out_").concat(n[1]),i="".concat(n[2],"_in_").concat(n[3]),r=Pt(o),c=Pt(i),a=r&&c?p.createCurvature(r,c):"";return Object(jt.jsx)(Kt,{svgKey:e,d:a},e)},qt=function(){var t=et(Object(r.useMemo)((function(){return Ct((function(t){var e=$(t).connections;return Object.entries(e).filter((function(t){return Object(u.a)(t,2)[1]}))}),(function(t){return t}))}),[])).map((function(t){var e=Object(u.a)(t,1)[0];return Object(jt.jsx)(Gt,{id:e},e)}));return Object(jt.jsx)(jt.Fragment,{children:t})},Ht=gt.b.div(X||(X=Object(l.a)(["\n  position: relative;\n  height: 100%;\n  overflow: hidden;\n  background: #282a36;\n  background-size: 25px 25px;\n  background-image: linear-gradient(to right, #2f323d 1px, transparent 1px),\n    linear-gradient(to bottom, #2f323d 1px, transparent 1px);\n"]))),Zt=gt.b.div(Y||(Y=Object(l.a)(["\n  width: 100%;\n  height: 100%;\n  position: relative;\n"]))),$t=function(){console.log("Render Drawflow");var t=et(Object(r.useMemo)((function(){return Ct((function(t){var e=$(t);return{config:{zoom:e.config.zoom},newPathDirection:e.newPathDirection,canvasDrag:e.canvasDrag}}),(function(t){return t}))}),[])),e=t.config.zoom,n=t.newPathDirection,o=t.canvasDrag,i=tt();Object(r.useEffect)((function(){i(bt())}),[i]);var c=Object(r.useRef)(null);return Object(r.useEffect)((function(){var t=c.current;if(t){var n,o=(null===(n=getComputedStyle(t).transform.match(/^matrix\((.+)\)$/))||void 0===n?void 0:n[1].split(",").slice(-2).map(Number))||[0,0],i=Object(u.a)(o,2),r=i[0],a=i[1];t.style.transform="translate(".concat(r,"px, ").concat(a,"px) scale(").concat(e.value,")")}}),[o,e.value]),Object(jt.jsxs)(Ht,{tabIndex:0,onKeyDownCapture:function(t){"Delete"===t.key&&(i(H.deletePath()),i(H.deleteNode())),t.ctrlKey&&"c"===t.key&&i(H.copyNode()),t.ctrlKey&&"v"===t.key&&i(H.insertCopiedNode())},onMouseDown:function(t){i(H.canvasDrag(!0)),i(H.unSelect())},onMouseUp:function(){return i(H.canvasMouseUp())},onMouseMove:function(t){var n=t.clientX,r=t.clientY,a=t.movementX,s=t.movementY,l=c.current;if(o&&l){var d,f=(null===(d=getComputedStyle(l).transform.match(/^matrix\((.+)\)$/))||void 0===d?void 0:d[1].split(",").slice(-2).map(Number))||[0,0],h=Object(u.a)(f,2),b=h[0],p=h[1];l.style.transform="translate(".concat(b+a,"px, ").concat(p+s,"px) scale(").concat(e.value,")")}i(H.canvasMouseMove({clientX:n,clientY:r,movementX:a,movementY:s}))},onMouseEnter:function(t){var e=t.clientX,n=t.clientY;i(lt({clientX:e,clientY:n}))},children:[Object(jt.jsx)(mt,{}),Object(jt.jsx)(kt,{}),Object(jt.jsxs)(Zt,{ref:c,className:"drawflow",style:{},children:[Object(jt.jsx)(Ut,{}),Object(jt.jsx)(qt,{}),n&&Object(jt.jsx)(Nt,{})]})]})},Qt=function(t){var e=t.searchWord,n=et((function(t){return t.templates})),o=tt(),i=e.toLowerCase().split(" ").filter((function(t){return t.length>0}));return Object(r.useEffect)((function(){o(ht())}),[o]),Object(jt.jsx)("div",{children:n.map((function(t,e){var n=t.name,r=t.type,c=t.value,a=JSON.stringify(t,null,2);return(i.find((function(t){return a.toLowerCase().includes(t)}))||!i.length)&&Object(jt.jsx)("div",{onMouseDownCapture:function(t){o(dt(1))},children:Object(jt.jsx)("pre",{children:"Type: ".concat(r,"\nValue: ").concat(c+n)})},e)}))})};n(40);var te=function(){var t=Object(r.useState)(""),e=Object(u.a)(t,2),n=e[0],o=e[1],i=tt();return console.log("Render App"),Object(r.useEffect)((function(){i(H.align())}),[i]),Object(jt.jsxs)("div",{className:"App",children:[Object(jt.jsxs)("div",{className:"drawflow-node-list",children:[Object(jt.jsx)("div",{className:"drawflow-node-list-search",children:Object(jt.jsx)("input",{type:"text",placeholder:"Search templates",onChange:function(t){o(t.target.value)}})}),Object(jt.jsx)("div",{className:"drawflow-node-list-flex",children:Object(jt.jsx)(Qt,{searchWord:n})})]}),Object(jt.jsxs)("div",{className:"flow",children:[Object(jt.jsxs)("div",{children:[Object(jt.jsx)("button",{onClick:function(){return i(bt())},children:"Fetch flow version"}),Object(jt.jsx)("button",{onClick:function(){return i(ut(0))},children:"Version 1"}),Object(jt.jsx)("button",{onClick:function(){return i(ut(1))},children:"Version 2"}),Object(jt.jsx)("button",{onClick:function(){return i(ut(2))},children:"Version 3"}),Object(jt.jsx)("button",{onClick:function(){return i(H.align())},children:"Align"})]}),Object(jt.jsx)($t,{})]})]})};s.a.render(Object(jt.jsx)(c.a.StrictMode,{children:Object(jt.jsx)(Q.a,{store:vt,children:Object(jt.jsx)(te,{})})}),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.d1d1dc4e.chunk.js.map